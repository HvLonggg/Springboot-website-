<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>ƒê∆°n h√†ng c·ªßa b·∫°n</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 40px;
      background: linear-gradient(135deg, #e0eafc, #cfdef3);
      color: #2c3e50;
    }
    h2 {
      text-align: center;
      margin-bottom: 30px;
      font-weight: 700;
      font-size: 2.2rem;
      color: #34495e;
      letter-spacing: 1.2px;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
      background: transparent;
      box-shadow: none;
      table-layout: fixed;
    }
    thead tr {
      background-color: #2980b9;
      color: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(41, 128, 185, 0.3);
    }
    thead th {
      padding: 15px 10px;
      text-align: center;
      font-weight: 700;
      font-size: 1rem;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      word-wrap: break-word;
    }
    tbody tr {
      background: white;
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border-radius: 10px;
      cursor: default;
    }
    tbody tr:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgb(0 0 0 / 0.15);
    }
    tbody td {
      padding: 15px 10px;
      text-align: center;
      font-size: 1rem;
      vertical-align: middle;
      border-bottom: none;
      border-radius: 10px;
      word-wrap: break-word;
    }
    /* Tr·∫°ng th√°i ƒë∆°n h√†ng */
    .status {
      font-weight: 700;
      padding: 5px 15px;
      border-radius: 20px;
      display: inline-block;
      min-width: 90px;
      text-transform: uppercase;
      font-size: 0.9rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      color: white;
      text-transform: none;
    }
    .PENDING {
      background-color: #f1c40f;
      box-shadow: 0 4px 8px #f1c40faa;
    }
    .PAID {
      background-color: #2ecc71;
      box-shadow: 0 4px 8px #2ecc71aa;
    }
    .CANCELLED {
      background-color: #e74c3c;
      box-shadow: 0 4px 8px #e74c3caa;
    }
    /* N√∫t h·ªßy ƒë∆°n */
    .btn-cancel {
      margin-left: 15px;
      padding: 6px 12px;
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .btn-cancel:hover:not([disabled]) {
      background-color: #c0392b;
    }
    /* N√∫t h·ªßy ƒë∆°n b·ªã v√¥ hi·ªáu h√≥a */
    .btn-cancel[disabled] {
      background-color: #ccc !important;
      color: #888 !important;
      text-decoration: line-through;
      cursor: not-allowed;
      box-shadow: none !important;
      user-select: none;
    }
    /* D√≤ng tr·ªëng khi kh√¥ng c√≥ ƒë∆°n h√†ng */
    .empty-row td {
      font-style: italic;
      color: #777;
      padding: 30px 20px;
      background: #fff8dc;
      border-radius: 10px;
      box-shadow: inset 0 0 15px #f39c1222;
      font-size: 1.1rem;
    }
    /* N√∫t quay l·∫°i fixed g√≥c tr√°i tr√™n */
    .btn-back {
      position: fixed;
      top: 30px;
      left: 20px;
      padding: 10px 18px;
      font-size: 1em;
      font-weight: 600;
      border-radius: 8px;
      text-decoration: none;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: white;
      box-shadow: 0 4px 12px rgba(52,152,219,0.6);
      transition: all 0.2s ease;
      z-index: 1000;
      user-select: none;
    }
    .btn-back:hover {
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
      color: #fff;
    }
    /* Modal n·ªÅn m·ªù */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .modal-overlay.active {
      display: flex;
    }
    /* Modal box */
    .modal-box {
      background: white;
      padding: 30px 25px;
      border-radius: 12px;
      width: 350px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      text-align: center;
      animation: fadeInScale 0.3s ease forwards;
    }
    @keyframes fadeInScale {
      0% {
        opacity: 0;
        transform: scale(0.7);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    .modal-box h3 {
      margin-bottom: 20px;
      font-size: 1.3rem;
      color: #e74c3c;
      font-weight: 700;
    }
    .modal-box p {
      margin-bottom: 25px;
      font-size: 1.1rem;
      color: #555;
    }
    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      margin: 0 10px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .modal-btn.confirm {
      background-color: #e74c3c;
      color: white;
    }
    .modal-btn.confirm:hover {
      background-color: #c0392b;
    }
    .modal-btn.cancel {
      background-color: #bdc3c7;
      color: #2c3e50;
    }
    .modal-btn.cancel:hover {
      background-color: #95a5a6;
    }
  </style>
</head>
<body>

<h2>üì¶ Danh s√°ch ƒë∆°n h√†ng c·ªßa b·∫°n</h2>
<a href="/user-dashboard" class="btn-back" role="button">‚Üê Trang ch·ªß</a>

<table>
  <thead>
  <tr>
    <th>M√£ ƒë∆°n</th>
    <th>Ng√†y ƒë·∫∑t</th>
    <th>T·ªïng ti·ªÅn</th>
    <th>Tr·∫°ng th√°i</th>
    <th>H√†nh ƒë·ªông</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="order : ${orders}">
    <td th:text="${order.id}">1</td>
    <td th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}">01/06/2025</td>
    <td th:text="${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 2, 'POINT')} + ' VNƒê'">0 VNƒê</td>
    <td>
        <span class="status"
              th:classappend="${order.status.name()}"
              th:switch="${order.status.name()}">
          <span th:case="'PENDING'">ƒêang x·ª≠ l√Ω</span>
          <span th:case="'PAID'">ƒê√£ thanh to√°n</span>
          <span th:case="'CANCELLED'">ƒê√£ h·ªßy</span>
          <span th:case="*">Kh√¥ng x√°c ƒë·ªãnh</span>
        </span>
    </td>
    <td>
      <form th:action="@{'/order/cancel/' + ${order.id}}" method="post" style="display:inline;" th:id="'cancelForm' + ${order.id}">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="button" class="btn-cancel"
                th:disabled="${order.status == null or order.status.name() != 'PENDING'}"
                th:attr="data-order-id=${order.id}">
          H·ªßy ƒë∆°n
        </button>
      </form>
    </td>
  </tr>
  <tr th:if="${#lists.isEmpty(orders)}" class="empty-row">
    <td colspan="5">B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</td>
  </tr>
  </tbody>
</table>

<!-- Modal X√°c nh·∫≠n H·ªßy ƒë∆°n -->
<div class="modal-overlay" id="confirmModal">
  <div class="modal-box">
    <h3>X√°c nh·∫≠n h·ªßy ƒë∆°n</h3>
    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n h√†ng n√†y kh√¥ng?</p>
    <button class="modal-btn confirm" id="modalConfirmBtn">X√°c nh·∫≠n</button>
    <button class="modal-btn cancel" id="modalCancelBtn">H·ªßy b·ªè</button>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('confirmModal');
    const confirmBtn = document.getElementById('modalConfirmBtn');
    const cancelBtn = document.getElementById('modalCancelBtn');
    let formToSubmit = null;

    // B·∫Øt s·ª± ki·ªán click c√°c n√∫t H·ªßy ƒë∆°n
    document.querySelectorAll('.btn-cancel').forEach(button => {
      button.addEventListener('click', function () {
        if (this.disabled) return;
        formToSubmit = this.closest('form');
        modal.classList.add('active');
      });
    });

    // Khi nh·∫•n n√∫t x√°c nh·∫≠n trong modal
    confirmBtn.addEventListener('click', function () {
      if (formToSubmit) {
        formToSubmit.submit();
      }
      modal.classList.remove('active');
    });

    // Khi nh·∫•n n√∫t h·ªßy b·ªè modal ho·∫∑c click ngo√†i modal
    cancelBtn.addEventListener('click', function () {
      modal.classList.remove('active');
      formToSubmit = null;
    });
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.classList.remove('active');
        formToSubmit = null;
      }
    });
  });
</script>

</body>
</html>
